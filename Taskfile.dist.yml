# yaml-language-server: $schema=https://taskfile.dev/schema.json

version: 3

includes:
  ci:
    taskfile: ./taskfiles/ci.yml
    dir: app

  app:
    taskfile: ./taskfiles/app.yml
    dir: app

tasks:
  default:
    cmd: task -l
    silent: true

  gh:run:watch:
    desc: Watch latest run
    cmd: |
      last_run=$(\
        gh run list \
        --workflow 'ci.yml' \
        --limit 1 \
        --json databaseId \
        | jq -r '.[0].databaseId' \
      )
      gh run watch $last_run
    silent: true

  gh:run:view:
    desc: View latest run
    cmd: |
      last_run=$(\
        gh run list \
        --workflow 'ci.yml' \
        --limit 1 \
        --json databaseId \
        | jq -r '.[0].databaseId' \
      )
      gh run view $last_run {{.CLI_ARGS}}
    silent: true

  tf:apply:
    desc: Apply Terraform changes
    interactive: true
    cmds:
      - cmd: |
          pushd ./modules/integrations/github/project_management && \
          terraform apply; \
          popd
